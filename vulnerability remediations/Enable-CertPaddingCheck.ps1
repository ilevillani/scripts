<#
.SYNOPSIS
    PowerShell script to remediate CVE-2013-3900 by ensuring that the EnableCertPaddingCheck registry value 
    is properly set on both 32-bit and 64-bit registry paths.
    Please test thoroughly in a non-production environment before deploying widely.
    Make sure to run as Administrator or with appropriate privileges.

.NOTES
    Author          : Ileana Villani
    LinkedIn        : linkedin.com/in/ileanavillani/
    GitHub          : github.com/ilevillani
    Date Created    : 2025-05-18
    Last Modified   : 2025-05-18
    Version         : 1.0
    CVEs            : CVE-2013-3900
    Plugin IDs      : 166555
    STIG-ID         : V-253284

.TESTED ON
    Date(s) Tested  : 2025-05-18
    Tested By       : Ileana Villani
    Systems Tested  : Windows Server 2019 Datacenter, Build 1809
                      Windows 10 Pro, Build 22H2
    PowerShell Ver. : 5.1.17763.6189

.USAGE
    Example syntax:
    PS C:\> .\Enable-CertPaddingCheck.ps1
#>



# Function to Set Registry Value
function Set-EnableCertPaddingCheck {
    param (
        [string]$RegistryPath
    )

    if (-not (Test-Path $RegistryPath)) {
        Write-Host "Creating Registry Path: $RegistryPath" -ForegroundColor Yellow
        New-Item -Path $RegistryPath -Force | Out-Null
    }

    # Set the EnableCertPaddingCheck to 1 (Enabled)
    New-ItemProperty -Path $RegistryPath -Name "EnableCertPaddingCheck" `
        -PropertyType DWORD -Value 1 -Force | Out-Null

    Write-Host "Configured EnableCertPaddingCheck at $RegistryPath" -ForegroundColor Green
}

# 32-bit Registry Path
$regPath32 = "HKLM:\Software\Microsoft\Cryptography\Wintrust\Config"

# 64-bit Registry Path (for Wow6432Node)
$regPath64 = "HKLM:\Software\Wow6432Node\Microsoft\Cryptography\Wintrust\Config"

# Apply Changes
Set-EnableCertPaddingCheck -RegistryPath $regPath32
Set-EnableCertPaddingCheck -RegistryPath $regPath64

Write-Host "`nRemediation Completed. It is recommended to restart the system to apply changes." -ForegroundColor Cyan
